# Simplified Market Depth Processor Configuration
# Equix Technologies Pty Ltd - Direct Snapshot Processing

# Global application settings
global:
  log_level: info                    # trace, debug, info, warn, error, critical, off
  log_path: ./app/logs               # Log file directory
  application_name: "market_depth_processor"
  version: "1.0.0"

# Kafka cluster configuration for both producer and consumer
kafka_cluster:
  bootstrap_servers: "localhost:29092"
  compression: "lz4"                # none, gzip, snappy, lz4, zstd
  acks: "1"                        # 0, 1, all
  queue_buffering_max_messages: 1000000
  batch_num_messages: 10000
  linger_ms: 5
  topics:
    - ORDERBOOK                    # Input topic
    # Output topics are dynamic: market_depth.[SYMBOL_NAME]

# Kafka consumer specific settings - 8 partitions consumption
kafka_consumer:
  bootstrap_servers: "localhost:29092"
  group_id: "simplified-market-depth-processor-group"
  session_timeout_ms: 6000
  auto_offset_reset: "earliest"     # earliest, latest, none
  enable_auto_commit: true
  auto_commit_interval_ms: 5000
  max_poll_records: 500
  fetch_min_bytes: 1
  fetch_max_wait_ms: 500
  topics:
    - ORDERBOOK

# Simplified Market Depth Processor configuration
processor:
  input_topic: "ORDERBOOK"
  poll_timeout_ms: 100
  num_partitions: 8                # Consume from 8 partitions
  flush_interval_ms: 1000          # How often to flush Kafka producer
  stats_interval_s: 30             # Statistics reporting interval
  enable_direct_processing: true   # Process snapshots directly without order book state

# Depth levels configuration - simplified
depth_config:
  levels: [5, 10, 25, 50]         # Depth levels to publish
  enable_cdc: false               # CDC disabled in simplified version
  enable_snapshots: true         # Only snapshots are published
  max_price_levels: 100           # Maximum price levels to process per side

# JSON output formatting configuration
json_config:
  price_decimals: 4               # Decimal places for price formatting
  quantity_decimals: 2            # Decimal places for quantity formatting
  include_timestamp: true         # Include timestamp in messages
  include_sequence: true          # Include sequence numbers
  compact_format: false           # Use pretty printing for readability
  exchange_name: "CXA"           # Default exchange name

# Simplified topic routing configuration
topic_config:
  snapshot_prefix: "market_depth."  # Topic format: market_depth.[SYMBOL_NAME]
  cdc_topic: "market_depth_cdc"    # Not used in simplified version
  use_depth_in_topic: false       # Symbol goes in topic name, not depth
  use_symbol_partitioning: true   # Use symbol-based partitioning
  num_partitions: 8               # Total partitions across all topics

# Performance monitoring and alerting
monitoring:
  enable_metrics: true
  metrics_port: 8080              # Prometheus metrics endpoint
  health_check_port: 8081         # Health check endpoint
  enable_performance_logging: true
  slow_processing_threshold_us: 1000  # Log if processing takes longer than 1ms
  memory_usage_check_interval_s: 60

# Production optimizations
performance:
  cpu_affinity: []                # CPU cores to bind to (empty = no binding)
  thread_priority: 0              # Thread priority (-20 to 19, 0 = normal)
  huge_pages: false               # Use huge pages for memory allocation
  numa_policy: "default"         # NUMA memory allocation policy
  batch_processing: true          # Enable batch processing optimizations
  zero_copy: true                 # Enable zero-copy optimizations where possible

# Failover and reliability
reliability:
  enable_circuit_breaker: true
  circuit_breaker_threshold: 100   # Failures before opening circuit
  circuit_breaker_timeout_s: 60    # Time before trying to close circuit
  max_retry_attempts: 3
  retry_backoff_ms: 1000
  enable_dead_letter_queue: false  # Simplified version doesn't need DLQ
  dead_letter_topic: "market_depth_dlq"

# Development and testing settings (override in dev/test configs)
development:
  enable_debug_logging: false
  log_message_payloads: false     # Log full message content (use only in dev)
  simulate_latency_us: 0          # Artificial latency for testing
  enable_profiling: false         # Enable performance profiling
  memory_leak_detection: false    # Enable memory leak detection

# Data validation and quality
data_quality:
  enable_validation: true
  max_price_deviation_percent: 50  # Alert if price moves more than 50%
  max_quantity_per_level: 1000000000  # Maximum quantity per price level
  min_sequence_number: 0
  enable_duplicate_detection: false  # Simplified version doesn't need this
  duplicate_cache_size: 10000

# Security settings
security:
  enable_ssl: false               # Enable SSL/TLS for Kafka connections
  ssl_ca_location: ""            # Path to CA certificate
  ssl_certificate_location: ""    # Path to client certificate
  ssl_key_location: ""           # Path to client private key
  ssl_key_password: ""           # Password for private key
  sasl_mechanism: "PLAIN"        # SASL mechanism (PLAIN, SCRAM-SHA-256, etc.)
  sasl_username: ""              # SASL username
  sasl_password: ""              # SASL password

# Simplified output destinations
outputs:
  kafka:
    enabled: true
    topic_format: "market_depth.{symbol}"  # Dynamic topic per symbol
  file:
    enabled: false
  database:
    enabled: false
  redis:
    enabled: false

# Symbol filtering and routing - simplified
symbol_config:
  enable_symbol_filter: false
  allowed_symbols: []             # Empty = allow all symbols
  blocked_symbols: []             # Symbols to explicitly block
  symbol_groups: {}               # Not used in simplified version

# Rate limiting and throttling - simplified
rate_limiting:
  enable_rate_limiting: false
  max_messages_per_second: 50000  # Higher throughput for simplified processing
  max_messages_per_symbol_per_second: 1000
  burst_size: 5000
  backoff_strategy: "linear"

# Timezone and localization
localization:
  timezone: "UTC"
  date_format: "ISO8601"
  number_format: "US"            # US, EU, etc.

# Simplified processor specific settings
simplified_processor:
  direct_snapshot_processing: true
  skip_order_book_state: true
  enable_fast_path: true
  parallel_symbol_processing: false  # Keep sequential for now
  max_symbols_in_memory: 100000
  symbol_cache_ttl_minutes: 60